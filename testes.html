<!DOCTYPE html>
<html lang="br">

<head>
  <meta charset="utf-8" />
  <meta property="og:title" content="Dominus RPG Solo" />
  <meta property="og:description" content='Escolha um cenário e jogue RPG Solo pelo sistema brasileiro Dominus' />
  <meta property="og:locale" content="pt-br" />
  <meta property="og:image" itemprop="image" content="dominusweb.png" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:alt" content="Imagem do Dominus" />
  <link rel="shortcut icon" href="imgs/favicon.ico">
  <meta property="description" content='Escolha um cenário e jogue RPG Solo pelo sistema brasileiro Dominus' />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Dominus - RPG Solo com Multiplos Cenários</title>
  <link rel="stylesheet" href="style.css" />
  <style id="stylefomat">
    input,
    button,
    textarea,
    input[type=text],
    input[type=file] {
      width: 700px;
    }

    textarea {
      height: 50vh;
      min-height: 200px;
    }
  </style>
</head>

<body>
  <h3>implementação (url)</h3>
  <input type="url" id="inurl"
    value="https://script.google.com/macros/s/AKfycbyEj_S-obS0w9-iBPFAfs1R8gMNYj8PFw48iQtUHRWLJmRGEqrnjy476K9UHKOEzIadew/exec" />
  <h3>Solicitações</h3>
  <button id="getlistbt">Baixar lista</button>
  <br />
  <input type="text" id="idscenin" placeholder="ID do Cenário" />
  <button id="getscena">Baixar cenário</button>
  <br />
  <input type="file" id="infile" accept=".json" placeholder="Carrecar cénario local" />
  <button id="sendscen">Enviar cenário</button>
  <br />
  <textarea id="output"></textarea>
</body>
<script>
  //implementação
  let urlbd = "https://script.google.com/macros/s/AKfycbyEj_S-obS0w9-iBPFAfs1R8gMNYj8PFw48iQtUHRWLJmRGEqrnjy476K9UHKOEzIadew/exec"
  //document.getElementById(inurl)
  let filelist = false;
  let scenario = {};
  inurl.addEventListener("change", () => {
    urlbd = inurl.value;
    output.value += "\nurl agora é: " + urlbd + "\n";
  });
  getlistbt.addEventListener("click", getlist);
  function getlist() {
    getrequest(urlbd + "?type=list");
  }
  getscena.addEventListener("click", getscen);
  function getscen() {
    const idscen = idscenin.value;
    getrequest(urlbd + "?type=scen&id=" + idscen);
  }
  function getrequest(url) {
    fetch(url).then(response => {
      if (response.status !== 200) {
        console.log('Looks like there was a problem. Status Code: ' + response.status);
        output.innerText += "\nerro " + response.status + "\n";
        return;
      }
      response.json().then(data => {
        console.log(data);
        output.innerText += "\n" + JSON.stringify(data.body) + "\n";
      });
    }).catch(err => {
      console.log('Fetch Error :-S', err);
      output.innerText += "\nerro " + err + "\n";
    });
  }
  sendscen.addEventListener("click", postrequest);
  function postrequest() {
    const he = new Headers();
    he.append("Access-Control-Allow-Origin", "*");
    if (filelist) {
      fetch(urlbd, { method: "POST", mode: "no-cors", header: he, body: scenario }).then(response => {
        if (response.status !== 200) {
          console.log('Looks like there was a problem. Status Code: ' + response.status);
          output.innerText += "\nerro " + response.status + "\n";
          return;
        }
        response.json().then(data => {
          console.log(data);
          output.innerText += "\n" + JSON.stringify(data.body) + "\n";
        });
      }).catch(err => {
        console.log('Fetch Error :-S', err);
        output.innerText += "\nerro " + err + "\n";
      });
    }
  }
  infile.addEventListener("change", function () {
    filelist = new FileReader();
    filelist.readAsText(infile.files[0]);
    filelist.onload = function () {
      scenario = JSON.parse(filelist.result);
    };
    filelist.onerror = function () {
      console.log(filelist.error);
    };
  });
</script>

</html>